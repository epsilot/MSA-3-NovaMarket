http {

    map $http_user_agent $client_type {

        default "other";
        ~*(iphone|android|mobile) "mobile";
        ~*(mozilla|chrome|safari|firefox) "web";

    }

    limit_req_zone $binary_remote_addr zone=web_limit:10m rate=50r/s;
    limit_req_zone $binary_remote_addr zone=mobile_limit:10m rate=30r/s;
    limit_req_zone $binary_remote_addr zone=other_limit:10m rate=5r/s;


    server {
        listen 80;

        location /api/ {
            if ($client_type = "web") {
                limit_req zone=web_limit burst=100;
            }

            if ($client_type = "mobile") {
                limit_req zone=mobile_limit burst=60;
            }

            if ($client_type = "other") {
                limit_req zone=other_limit burst=10;
            }

            proxy_pass http://backend;
        }

    }
}
