**Название задачи:** ADR-0001. Реализация сценария взаимодействия "Просмотр истории покупок"

**Автор:** Фарков Михаил

**Дата:** 23.10.2025

### Функциональные требования

| Код | Описание                                                                                                                |
|-----|-------------------------------------------------------------------------------------------------------------------------|
| F1  | Отображать списком историю всех заказов                                                                                 |
| F2  | Для каждого заказа необходимо отображать перечень всех заказанных товаров, цену, метод оплаты, способ и статус доставки |
| F3  | Пользователь может просмотреть чек по заказу                                                                            |
| F4  | Пользователь может заказать товары повторно                                                                             |

### Нефункциональные требования

| Код | Требование                                                                                               |
|-----|----------------------------------------------------------------------------------------------------------|
| P1  | Время ответа меньше 1 секунды для 99.99% запросов                                                        |
| P2  | Время ответа меньше 0.3 секунды для 98% запросов                                                         |

### Решение

- Для выполнения поставленных нефункциональных требований наилучшим вариантом видится создание отдельного микросервиса
  "История заказов".
- Информация о заказах в микросервис будет поступать по средствам CQRS.
- Разрабатываемый микросервис будет подписан на ключевые события, которые относятся к заказам и сохранять требуемые
  данные в своей базе данных.
- Такое решение позволит минимизировать, либо полностью исключить, запросы к другим сервисам при формировании истории
  заказов, что позволит уложиться в заявленные нефункциональные требования, а также исключит дополнительную нагрузку на
  ключевые микросервисы приложения и уменьшит внутреннюю связность микросервисов.

### Альтернативы

- В качестве альтернативного варианта рассматривалось использование API Composition.
- Ключевым преимуществом такого решения является исключение денормализации данных и размытия доменной модели между
  разными микросервисами.
- Однако такой подход приведёт к высокой связности между микросервисами, а также не позволит уложиться в установленные
  нефункциональные требования при возникновении повышенной нагрузки на ключевые микросервисы.

### Недостатки, ограничения, риски

- Выбранные подход может привести к рассинхронизации данных о состоянии заказов/оплаты и т.п. Вероятно следует
  предусмотреть дополнительные процедуры синхронизации данных, например при просмотре пользователем конкретного заказа.
- Также проблемой является размытие доменной области между разными микросервисами. А именно, разрабатываемы микросервис
  должен "знать" большое количество информации из соседних микросервисах (например, методы оплаты или способы/тарифы
  доставки), что потребует дополнительных согласований при изменении ключевых микросервисах. Для минимизации указанного
  риска следует согласовать подходы к именованию различных статусов/сущностей. Также, вероятно, следует передать
  разрабатываем микросервис команде, ответственно за разработку микросервиса "Управление заказами", так как видится,
  что с этим микросервисом имеется наибольшая логическая связь.